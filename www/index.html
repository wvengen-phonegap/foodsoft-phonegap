<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Foodsoft</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <link rel="stylesheet" type="text/css" href="assets/jquery.mobile-1.4.0.min.css">
</head>
<body>

  <!-- frontpage -->
  <div data-role='page' id='page-front' data-title='Foodsoft'>
    <div data-role='header'>
      <h1>Foodsoft</h1>
    </div>

    <div data-role='content'>
      <p>Welcome to the Foodsoft app! This app will help you to work with your local foodcoop even easier.</p>
      <p><a href='javascript:visitSite();' data-role='button'>go to foodcoop</a></p>
      <p><a href='#page-about' data-role='button'>about</a></p>
    </div>

    <div data-role='footer'>
      <p><a href='#page-settings'></a></p>
    </div>
  </div>

  <!-- about page -->
  <div data-role='page' id='page-about' data-title='About Foodsoft'>
    <div data-role='header'>
      <a href="javascript:history.back()" data-icon="arrow-l">Back</a>
      <h1>About</h1>
    </div>
    
    <div data-role='content'>
      <ul data-role='listview' data-inset='true'>
        <li data-role='list-divider'>Development</li>
        <li>
          <a href='mailto:foodsoft@foodcoop.nl'>Foodcoop NL</a>
        </li>
      </ul>
    </div>
  </div>

  <!-- offline popup -->
  <div data-role='dialog' id='dialog-offline' data-title='Foodsoft (offline)'>
    <div data-role='content'>
      <p>You need an internet connection to access your foodcoop.</p>
    </div>
  </div>

  <!-- code -->
  <script type="text/javascript" src="phonegap.js"></script>
  <script type="text/javascript" src="assets/jquery-2.0.3.min.js"></script>
  <script type="text/javascript">
    $(document).bind('mobileinit', function () {
      $.extend($.mobile, {
        defaultPageTransition: 'none'
      });
    });
  </script>
  <script type="text/javascript" src="assets/jquery.mobile-1.4.0.min.js"></script>
  <script type="text/javascript">
    var sitewnd = null;

    $(document).bind('deviceready', function() {

      // we need to be online to access the website
      $(document).bind('offline', function() {
        if (localStorage['ignore_offline']) return;
        if (sitewnd) { // TODO check if sitewnd has focus
          $('#page-offline').popup('open');
        }
      });
      $(document).bind('online', function() {
        if (localStorage['ignore_offline']) return;
        $('.ui-dialog#page-offline').dialog('close');
      });
      $(document).bind('menubutton', function() {
        // TODO popup menu
      });

      //visitSite();
    });

    function visitSite() {
      // if we have a foodcoop preference, go there immediately
      //var url = localStorage['default_url'];
      var url = 'https://order.foodcoop.nl/' + 'app' + 'test.html';
      if (url) {
        spinnerplugin.show({});
        sitewnd = window.open(encodeURI(url), '_blank', 'location=no');
        $(sitewnd).bind('loadstop', function() {
          // inAppBrowser doesn't handle back by itself
          $(document).bind('backbutton', function() {
            // TODO check window still exists
            cordova.exec(null, null, "InAppBrowser", "injectScriptCode", ["history.back()"]);
          }, false);
          // inject javascript to let foodsoft offer mobile integration
          sitewnd.executeScript({code:
            'var foodsoftMobile = true;'
          });
          spinnerplugin.hide();
        });
        $(sitewnd).bind('loaderror', function(ev) {
          spinnerplugin.hide();
          alert('Error: '+ev.message);
        });
      }
    }

    function currentPage() {
      return $('.ui-page-active').attr('id');
    }
  </script>
</body>
</html>
